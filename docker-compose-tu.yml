version: '3.1'

services:
  ############################
  # Database
  ############################
  delain_dbtu:
    image: postgres
    environment:
      - POSTGRES_PASSWORD=mypassword
      - POSTGRES_USER=delain
      - POSTGRES_DB=delain
    volumes:
      - ../../sql_init:/docker-entrypoint-initdb.d
      - ../../:/home/delain/delain
      - ./conf.php:/home/delain/delain/web/www/includes/conf.php

    container_name: delain_dbtu
    networks:
      - delaintu
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 10s
      timeout: 10s
      retries: 60
  ###############################
  # Serveur web
  ###############################
  webtu:
    build:
      dockerfile: ./Dockerfile_launch
      context: .
    container_name: webtu
    networks:
      - delaintu
    depends_on:
      delain_dbtu:
        condition: service_healthy
networks:
  delaintu:
    driver: bridge
 
